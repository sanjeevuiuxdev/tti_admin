{
    "sourceFile": "src/pages/Comments.jsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 10,
            "patches": [
                {
                    "date": 1762458635872,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1762633227063,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -45,9 +45,9 @@\n         </thead>\n         <tbody>\n           {rows.map((c) => (\n             <tr key={c._id}>\n-              <td>{c.post?.title} <small>({c.post?.slug})</small></td>\n+              {/* <td>{c.post?.title} <small>({c.post?.slug})</small></td> */}\n               <td>{c.name}</td>\n               <td>{c.email}</td>\n               <td style={{ maxWidth: 420, whiteSpace: \"pre-wrap\" }}>{c.message}</td>\n               <td>{c.approved ? \"Yes\" : \"No\"}</td>\n"
                },
                {
                    "date": 1762633233004,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -46,8 +46,9 @@\n         <tbody>\n           {rows.map((c) => (\n             <tr key={c._id}>\n               {/* <td>{c.post?.title} <small>({c.post?.slug})</small></td> */}\n+              <td>{c.post?.title}</td>\n               <td>{c.name}</td>\n               <td>{c.email}</td>\n               <td style={{ maxWidth: 420, whiteSpace: \"pre-wrap\" }}>{c.message}</td>\n               <td>{c.approved ? \"Yes\" : \"No\"}</td>\n"
                },
                {
                    "date": 1762635174565,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,74 +1,330 @@\n-import { useEffect, useState } from \"react\";\n+// src/pages/Comments.tsx\n+import { useEffect, useMemo, useState } from \"react\";\n import { adminFetch } from \"../api/adminFetch\";\n \n+type Cmt = {\n+  _id: string;\n+  post?: { _id: string; slug: string; title: string };\n+  name: string;\n+  email: string;\n+  message: string;\n+  approved: boolean;\n+  createdAt?: string;\n+};\n+\n+const PER_PAGE = 20;\n+\n+function fmtDate(iso?: string) {\n+  if (!iso) return \"\";\n+  try {\n+    return new Date(iso).toLocaleString();\n+  } catch {\n+    return \"\";\n+  }\n+}\n+\n export default function Comments() {\n-  const [rows, setRows] = useState([]);\n+  const [rows, setRows] = useState<Cmt[]>([]);\n   const [loading, setLoading] = useState(true);\n+  const [q, setQ] = useState(\"\");\n+  const [tab, setTab] = useState<\"all\" | \"pending\" | \"approved\">(\"all\");\n+  const [page, setPage] = useState(1);\n+  const [selected, setSelected] = useState<Set<string>>(new Set());\n \n   async function load() {\n     setLoading(true);\n     try {\n-      const data = await adminFetch(\"/api/admin/comments\"); // all comments\n-      setRows(data);\n+      const data = await adminFetch(\"/api/admin/comments\"); // returns newest first or not—doesn’t matter, we sort below\n+      setRows(Array.isArray(data) ? data : []);\n+      setSelected(new Set());\n+      setPage(1);\n     } finally {\n       setLoading(false);\n     }\n   }\n \n-  useEffect(() => { load(); }, []);\n+  useEffect(() => {\n+    load();\n+  }, []);\n \n-  async function approve(id) {\n+  // ------- derived list -------\n+  const filtered = useMemo(() => {\n+    let list = [...rows].sort((a, b) => {\n+      const ta = new Date(a.createdAt || 0).getTime();\n+      const tb = new Date(b.createdAt || 0).getTime();\n+      return tb - ta; // newest first\n+    });\n+\n+    if (tab === \"pending\") list = list.filter((r) => !r.approved);\n+    if (tab === \"approved\") list = list.filter((r) => r.approved);\n+\n+    if (q.trim()) {\n+      const s = q.toLowerCase();\n+      list = list.filter(\n+        (r) =>\n+          r.name.toLowerCase().includes(s) ||\n+          r.email.toLowerCase().includes(s) ||\n+          r.message.toLowerCase().includes(s) ||\n+          (r.post?.title || \"\").toLowerCase().includes(s) ||\n+          (r.post?.slug || \"\").toLowerCase().includes(s)\n+      );\n+    }\n+\n+    return list;\n+  }, [rows, q, tab]);\n+\n+  const totalPages = Math.max(1, Math.ceil(filtered.length / PER_PAGE));\n+  const pageRows = filtered.slice((page - 1) * PER_PAGE, page * PER_PAGE);\n+\n+  // ------- actions -------\n+  async function approveOne(id: string) {\n     await adminFetch(`/api/admin/comments/${id}/approve`, { method: \"PUT\" });\n     await load();\n   }\n \n-  async function remove(id) {\n-    if (!confirm(\"Delete comment?\")) return;\n+  async function deleteOne(id: string) {\n+    if (!confirm(\"Delete this comment?\")) return;\n     await adminFetch(`/api/admin/comments/${id}`, { method: \"DELETE\" });\n     await load();\n   }\n \n+  async function bulkApprove() {\n+    const ids = [...selected];\n+    if (!ids.length) return;\n+    await Promise.all(ids.map((id) => adminFetch(`/api/admin/comments/${id}/approve`, { method: \"PUT\" })));\n+    await load();\n+  }\n+\n+  async function bulkDelete() {\n+    const ids = [...selected];\n+    if (!ids.length) return;\n+    if (!confirm(`Delete ${ids.length} selected comment(s)?`)) return;\n+    await Promise.all(ids.map((id) => adminFetch(`/api/admin/comments/${id}`, { method: \"DELETE\" })));\n+    await load();\n+  }\n+\n+  function toggleAllOnPage(check: boolean) {\n+    const next = new Set(selected);\n+    pageRows.forEach((r) => (check ? next.add(r._id) : next.delete(r._id)));\n+    setSelected(next);\n+  }\n+\n+  function toggleRow(id: string) {\n+    const next = new Set(selected);\n+    if (next.has(id)) next.delete(id);\n+    else next.add(id);\n+    setSelected(next);\n+  }\n+\n   return (\n     <div className=\"page\">\n-      <h2>Comments Moderation</h2>\n-      {loading ? <p>Loading…</p> : null}\n-      <table className=\"card\" style={{ width: \"100%\" }}>\n-        <thead>\n-          <tr>\n-            <th>Post</th>\n-            <th>Name</th>\n-            <th>Email</th>\n-            <th>Message</th>\n-            <th>Approved</th>\n-            <th>Actions</th>\n-          </tr>\n-        </thead>\n-        <tbody>\n-          {rows.map((c) => (\n-            <tr key={c._id}>\n-              {/* <td>{c.post?.title} <small>({c.post?.slug})</small></td> */}\n-              <td>{c.post?.title}</td>\n-              <td>{c.name}</td>\n-              <td>{c.email}</td>\n-              <td style={{ maxWidth: 420, whiteSpace: \"pre-wrap\" }}>{c.message}</td>\n-              <td>{c.approved ? \"Yes\" : \"No\"}</td>\n-              <td>\n-                {!c.approved && (\n-                  <button onClick={() => approve(c._id)} style={{ marginRight: 8 }}>\n-                    Approve\n-                  </button>\n-                )}\n-                <button onClick={() => remove(c._id)} className=\"danger\">\n-                  Delete\n-                </button>\n-              </td>\n-            </tr>\n-          ))}\n-          {rows.length === 0 && !loading && (\n-            <tr><td colSpan={6}>No comments yet.</td></tr>\n-          )}\n-        </tbody>\n-      </table>\n+      <h2 style={{ marginBottom: 12 }}>Comments Moderation</h2>\n+\n+      {/* Controls row */}\n+      <div className=\"card\" style={{ display: \"flex\", gap: 12, alignItems: \"center\", flexWrap: \"wrap\" }}>\n+        <div className=\"seg\">\n+          <button\n+            className={`seg-btn ${tab === \"all\" ? \"active\" : \"\"}`}\n+            onClick={() => {\n+              setTab(\"all\");\n+              setPage(1);\n+            }}\n+          >\n+            All ({rows.length})\n+          </button>\n+          <button\n+            className={`seg-btn ${tab === \"pending\" ? \"active\" : \"\"}`}\n+            onClick={() => {\n+              setTab(\"pending\");\n+              setPage(1);\n+            }}\n+          >\n+            Pending ({rows.filter((r) => !r.approved).length})\n+          </button>\n+          <button\n+            className={`seg-btn ${tab === \"approved\" ? \"active\" : \"\"}`}\n+            onClick={() => {\n+              setTab(\"approved\");\n+              setPage(1);\n+            }}\n+          >\n+            Approved ({rows.filter((r) => r.approved).length})\n+          </button>\n+        </div>\n+\n+        <input\n+          className=\"tf-input\"\n+          placeholder=\"Search name, email, post, text…\"\n+          value={q}\n+          onChange={(e) => {\n+            setQ(e.target.value);\n+            setPage(1);\n+          }}\n+          style={{ minWidth: 260, flex: \"0 0 280px\" }}\n+        />\n+\n+        <div style={{ marginLeft: \"auto\", display: \"flex\", gap: 8 }}>\n+          <button className=\"secondary\" disabled={!selected.size} onClick={bulkApprove}>\n+            Approve selected\n+          </button>\n+          <button className=\"danger\" disabled={!selected.size} onClick={bulkDelete}>\n+            Delete selected\n+          </button>\n+          <button onClick={load}>Refresh</button>\n+        </div>\n+      </div>\n+\n+      {/* Table */}\n+      <div className=\"card\" style={{ marginTop: 16, padding: 0, overflowX: \"auto\" }}>\n+        {loading ? (\n+          <div style={{ padding: 16 }}>Loading…</div>\n+        ) : (\n+          <table className=\"table-flat\">\n+            <thead>\n+              <tr>\n+                <th style={{ width: 36 }}>\n+                  <input\n+                    type=\"checkbox\"\n+                    checked={pageRows.length > 0 && pageRows.every((r) => selected.has(r._id))}\n+                    onChange={(e) => toggleAllOnPage(e.target.checked)}\n+                  />\n+                </th>\n+                <th>Post</th>\n+                <th>Author</th>\n+                <th>Email</th>\n+                <th>Comment</th>\n+                <th style={{ width: 110 }}>Status</th>\n+                <th style={{ width: 160, textAlign: \"right\" }}>Actions</th>\n+              </tr>\n+            </thead>\n+            <tbody>\n+              {pageRows.map((c) => (\n+                <tr key={c._id}>\n+                  <td>\n+                    <input\n+                      type=\"checkbox\"\n+                      checked={selected.has(c._id)}\n+                      onChange={() => toggleRow(c._id)}\n+                      aria-label=\"select row\"\n+                    />\n+                  </td>\n+\n+                  <td>\n+                    <div className=\"cell-post\">\n+                      <div className=\"post-title\">{c.post?.title || \"—\"}</div>\n+                      {c.post?.slug ? (\n+                        <a\n+                          href={`/blog/${c.post.slug}`}\n+                          target=\"_blank\"\n+                          rel=\"noreferrer\"\n+                          className=\"post-link\"\n+                          title=\"Open post in new tab\"\n+                        >\n+                          /blog/{c.post.slug}\n+                        </a>\n+                      ) : null}\n+                      <div className=\"post-date\">{fmtDate(c.createdAt)}</div>\n+                    </div>\n+                  </td>\n+\n+                  <td>{c.name || \"—\"}</td>\n+                  <td>\n+                    <a href={`mailto:${c.email}`} className=\"muted link\">\n+                      {c.email}\n+                    </a>\n+                  </td>\n+\n+                  <td>\n+                    <ExpandableText text={c.message} max={160} />\n+                  </td>\n+\n+                  <td>\n+                    {c.approved ? (\n+                      <span className=\"badge ok\">Approved</span>\n+                    ) : (\n+                      <span className=\"badge warn\">Pending</span>\n+                    )}\n+                  </td>\n+\n+                  <td style={{ textAlign: \"right\" }}>\n+                    {!c.approved && (\n+                      <button className=\"small\" onClick={() => approveOne(c._id)} style={{ marginRight: 8 }}>\n+                        Approve\n+                      </button>\n+                    )}\n+                    <button className=\"small danger\" onClick={() => deleteOne(c._id)}>\n+                      Delete\n+                    </button>\n+                  </td>\n+                </tr>\n+              ))}\n+\n+              {!pageRows.length && (\n+                <tr>\n+                  <td colSpan={7} style={{ padding: 16 }}>\n+                    No comments found.\n+                  </td>\n+                </tr>\n+              )}\n+            </tbody>\n+          </table>\n+        )}\n+      </div>\n+\n+      {/* Pagination */}\n+      {totalPages > 1 && (\n+        <div className=\"pager\">\n+          <button disabled={page === 1} onClick={() => setPage((p) => Math.max(1, p - 1))}>\n+            ‹ Prev\n+          </button>\n+          <div className=\"pages\">\n+            Page {page} / {totalPages}\n+          </div>\n+          <button disabled={page === totalPages} onClick={() => setPage((p) => Math.min(totalPages, p + 1))}>\n+            Next ›\n+          </button>\n+        </div>\n+      )}\n+\n+      {/* Tiny styles to match your admin look without new CSS files */}\n+      <style>{`\n+        .seg { display:flex; gap:6px; }\n+        .seg-btn{ padding:6px 10px; border-radius:8px; border:1px solid #e5e7eb; background:#fff; }\n+        .seg-btn.active{ background:#111; color:#fff; border-color:#111; }\n+\n+        .table-flat{ width:100%; border-collapse:separate; border-spacing:0; }\n+        .table-flat thead th{ text-align:left; font-weight:700; padding:12px 14px; border-bottom:1px solid #eee; background:#fafafa;}\n+        .table-flat tbody td{ padding:14px; border-bottom:1px solid #f2f2f2; vertical-align:top; }\n+        .cell-post .post-title{ font-weight:600; }\n+        .cell-post .post-link{ font-size:12px; color:#6b7280; display:inline-block; margin-top:2px; }\n+        .cell-post .post-date{ font-size:12px; color:#9ca3af; margin-top:2px; }\n+\n+        .badge{ padding:4px 8px; border-radius:999px; font-size:12px; font-weight:600; display:inline-block; }\n+        .badge.ok{ background:#e9f9ee; color:#126b2e; }\n+        .badge.warn{ background:#fff7e6; color:#8a5a00; }\n+\n+        .muted{ color:#6b7280; }\n+        .small{ padding:6px 10px; border-radius:8px; }\n+        .secondary{ background:#fff; border:1px solid #e5e7eb; }\n+        .danger{ background:#111; color:#fff; }\n+        .pager{ display:flex; align-items:center; gap:12px; justify-content:flex-end; margin-top:14px; }\n+        .pages{ color:#6b7280; }\n+      `}</style>\n     </div>\n   );\n }\n+\n+/** Truncates long comment text with a toggle to expand/collapse */\n+function ExpandableText({ text, max = 160 }: { text: string; max?: number }) {\n+  const [open, setOpen] = useState(false);\n+  const t = text || \"\";\n+  if (t.length <= max) return <span>{t}</span>;\n+  return (\n+    <div>\n+      <span>{open ? t : t.slice(0, max) + \"…\"}</span>{\" \"}\n+      <button className=\"small secondary\" onClick={() => setOpen((v) => !v)}>\n+        {open ? \"Collapse\" : \"Read more\"}\n+      </button>\n+    </div>\n+  );\n+}\n"
                },
                {
                    "date": 1762636093970,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3,9 +3,9 @@\n import { adminFetch } from \"../api/adminFetch\";\n \n type Cmt = {\n   _id: string;\n-  post?: { _id: string; slug: string; title: string };\n+  post?: { slug: string; title: string };\n   name: string;\n   email: string;\n   message: string;\n   approved: boolean;\n@@ -13,31 +13,20 @@\n };\n \n const PER_PAGE = 20;\n \n-function fmtDate(iso?: string) {\n-  if (!iso) return \"\";\n-  try {\n-    return new Date(iso).toLocaleString();\n-  } catch {\n-    return \"\";\n-  }\n-}\n-\n export default function Comments() {\n   const [rows, setRows] = useState<Cmt[]>([]);\n   const [loading, setLoading] = useState(true);\n   const [q, setQ] = useState(\"\");\n-  const [tab, setTab] = useState<\"all\" | \"pending\" | \"approved\">(\"all\");\n+  const [status, setStatus] = useState<\"all\" | \"pending\" | \"approved\">(\"all\");\n   const [page, setPage] = useState(1);\n-  const [selected, setSelected] = useState<Set<string>>(new Set());\n \n   async function load() {\n     setLoading(true);\n     try {\n-      const data = await adminFetch(\"/api/admin/comments\"); // returns newest first or not—doesn’t matter, we sort below\n+      const data = await adminFetch(\"/api/admin/comments\");\n       setRows(Array.isArray(data) ? data : []);\n-      setSelected(new Set());\n       setPage(1);\n     } finally {\n       setLoading(false);\n     }\n@@ -46,285 +35,145 @@\n   useEffect(() => {\n     load();\n   }, []);\n \n-  // ------- derived list -------\n   const filtered = useMemo(() => {\n-    let list = [...rows].sort((a, b) => {\n-      const ta = new Date(a.createdAt || 0).getTime();\n-      const tb = new Date(b.createdAt || 0).getTime();\n-      return tb - ta; // newest first\n-    });\n-\n-    if (tab === \"pending\") list = list.filter((r) => !r.approved);\n-    if (tab === \"approved\") list = list.filter((r) => r.approved);\n-\n+    let list = [...rows];\n+    if (status === \"pending\") list = list.filter(r => !r.approved);\n+    if (status === \"approved\") list = list.filter(r => r.approved);\n     if (q.trim()) {\n       const s = q.toLowerCase();\n-      list = list.filter(\n-        (r) =>\n-          r.name.toLowerCase().includes(s) ||\n-          r.email.toLowerCase().includes(s) ||\n-          r.message.toLowerCase().includes(s) ||\n-          (r.post?.title || \"\").toLowerCase().includes(s) ||\n-          (r.post?.slug || \"\").toLowerCase().includes(s)\n+      list = list.filter(r =>\n+        (r.post?.title || \"\").toLowerCase().includes(s) ||\n+        (r.post?.slug || \"\").toLowerCase().includes(s) ||\n+        (r.name || \"\").toLowerCase().includes(s) ||\n+        (r.email || \"\").toLowerCase().includes(s) ||\n+        (r.message || \"\").toLowerCase().includes(s)\n       );\n     }\n-\n+    // newest first if createdAt available\n+    list.sort((a, b) => (new Date(b.createdAt || 0).getTime() - new Date(a.createdAt || 0).getTime()));\n     return list;\n-  }, [rows, q, tab]);\n+  }, [rows, q, status]);\n \n   const totalPages = Math.max(1, Math.ceil(filtered.length / PER_PAGE));\n   const pageRows = filtered.slice((page - 1) * PER_PAGE, page * PER_PAGE);\n \n-  // ------- actions -------\n-  async function approveOne(id: string) {\n+  async function approve(id: string) {\n     await adminFetch(`/api/admin/comments/${id}/approve`, { method: \"PUT\" });\n     await load();\n   }\n-\n-  async function deleteOne(id: string) {\n-    if (!confirm(\"Delete this comment?\")) return;\n+  async function remove(id: string) {\n+    if (!confirm(\"Delete comment?\")) return;\n     await adminFetch(`/api/admin/comments/${id}`, { method: \"DELETE\" });\n     await load();\n   }\n \n-  async function bulkApprove() {\n-    const ids = [...selected];\n-    if (!ids.length) return;\n-    await Promise.all(ids.map((id) => adminFetch(`/api/admin/comments/${id}/approve`, { method: \"PUT\" })));\n-    await load();\n-  }\n-\n-  async function bulkDelete() {\n-    const ids = [...selected];\n-    if (!ids.length) return;\n-    if (!confirm(`Delete ${ids.length} selected comment(s)?`)) return;\n-    await Promise.all(ids.map((id) => adminFetch(`/api/admin/comments/${id}`, { method: \"DELETE\" })));\n-    await load();\n-  }\n-\n-  function toggleAllOnPage(check: boolean) {\n-    const next = new Set(selected);\n-    pageRows.forEach((r) => (check ? next.add(r._id) : next.delete(r._id)));\n-    setSelected(next);\n-  }\n-\n-  function toggleRow(id: string) {\n-    const next = new Set(selected);\n-    if (next.has(id)) next.delete(id);\n-    else next.add(id);\n-    setSelected(next);\n-  }\n-\n   return (\n     <div className=\"page\">\n       <h2 style={{ marginBottom: 12 }}>Comments Moderation</h2>\n \n-      {/* Controls row */}\n-      <div className=\"card\" style={{ display: \"flex\", gap: 12, alignItems: \"center\", flexWrap: \"wrap\" }}>\n-        <div className=\"seg\">\n-          <button\n-            className={`seg-btn ${tab === \"all\" ? \"active\" : \"\"}`}\n-            onClick={() => {\n-              setTab(\"all\");\n-              setPage(1);\n-            }}\n-          >\n-            All ({rows.length})\n-          </button>\n-          <button\n-            className={`seg-btn ${tab === \"pending\" ? \"active\" : \"\"}`}\n-            onClick={() => {\n-              setTab(\"pending\");\n-              setPage(1);\n-            }}\n-          >\n-            Pending ({rows.filter((r) => !r.approved).length})\n-          </button>\n-          <button\n-            className={`seg-btn ${tab === \"approved\" ? \"active\" : \"\"}`}\n-            onClick={() => {\n-              setTab(\"approved\");\n-              setPage(1);\n-            }}\n-          >\n-            Approved ({rows.filter((r) => r.approved).length})\n-          </button>\n-        </div>\n+      {/* Controls */}\n+      <div className=\"card\" style={{ display: \"flex\", gap: 8, alignItems: \"center\", flexWrap: \"wrap\" }}>\n+        <select\n+          value={status}\n+          onChange={(e) => { setStatus(e.target.value as any); setPage(1); }}\n+          className=\"tf-input\"\n+          style={{ width: 160 }}\n+        >\n+          <option value=\"all\">All</option>\n+          <option value=\"pending\">Pending</option>\n+          <option value=\"approved\">Approved</option>\n+        </select>\n \n         <input\n           className=\"tf-input\"\n-          placeholder=\"Search name, email, post, text…\"\n+          placeholder=\"Search…\"\n           value={q}\n-          onChange={(e) => {\n-            setQ(e.target.value);\n-            setPage(1);\n-          }}\n-          style={{ minWidth: 260, flex: \"0 0 280px\" }}\n+          onChange={(e) => { setQ(e.target.value); setPage(1); }}\n+          style={{ minWidth: 220 }}\n         />\n \n-        <div style={{ marginLeft: \"auto\", display: \"flex\", gap: 8 }}>\n-          <button className=\"secondary\" disabled={!selected.size} onClick={bulkApprove}>\n-            Approve selected\n-          </button>\n-          <button className=\"danger\" disabled={!selected.size} onClick={bulkDelete}>\n-            Delete selected\n-          </button>\n-          <button onClick={load}>Refresh</button>\n-        </div>\n+        <button onClick={load} style={{ marginLeft: \"auto\" }}>Refresh</button>\n       </div>\n \n       {/* Table */}\n-      <div className=\"card\" style={{ marginTop: 16, padding: 0, overflowX: \"auto\" }}>\n+      <div className=\"card\" style={{ marginTop: 12, padding: 0, overflowX: \"auto\" }}>\n         {loading ? (\n-          <div style={{ padding: 16 }}>Loading…</div>\n+          <div style={{ padding: 14 }}>Loading…</div>\n         ) : (\n-          <table className=\"table-flat\">\n+          <table className=\"simple-table\">\n             <thead>\n               <tr>\n-                <th style={{ width: 36 }}>\n-                  <input\n-                    type=\"checkbox\"\n-                    checked={pageRows.length > 0 && pageRows.every((r) => selected.has(r._id))}\n-                    onChange={(e) => toggleAllOnPage(e.target.checked)}\n-                  />\n-                </th>\n-                <th>Post</th>\n-                <th>Author</th>\n-                <th>Email</th>\n-                <th>Comment</th>\n-                <th style={{ width: 110 }}>Status</th>\n-                <th style={{ width: 160, textAlign: \"right\" }}>Actions</th>\n+                <th style={{ minWidth: 220 }}>Post</th>\n+                <th style={{ minWidth: 160 }}>Name / Email</th>\n+                <th>Message</th>\n+                <th style={{ width: 90 }}>Status</th>\n+                <th style={{ width: 150, textAlign: \"right\" }}>Actions</th>\n               </tr>\n             </thead>\n             <tbody>\n               {pageRows.map((c) => (\n                 <tr key={c._id}>\n                   <td>\n-                    <input\n-                      type=\"checkbox\"\n-                      checked={selected.has(c._id)}\n-                      onChange={() => toggleRow(c._id)}\n-                      aria-label=\"select row\"\n-                    />\n+                    <div style={{ fontWeight: 600 }}>{c.post?.title || \"—\"}</div>\n+                    {c.post?.slug && (\n+                      <a\n+                        href={`/blog/${c.post.slug}`}\n+                        target=\"_blank\"\n+                        rel=\"noreferrer\"\n+                        style={{ fontSize: 12, color: \"#6b7280\" }}\n+                      >\n+                        /blog/{c.post.slug}\n+                      </a>\n+                    )}\n                   </td>\n-\n                   <td>\n-                    <div className=\"cell-post\">\n-                      <div className=\"post-title\">{c.post?.title || \"—\"}</div>\n-                      {c.post?.slug ? (\n-                        <a\n-                          href={`/blog/${c.post.slug}`}\n-                          target=\"_blank\"\n-                          rel=\"noreferrer\"\n-                          className=\"post-link\"\n-                          title=\"Open post in new tab\"\n-                        >\n-                          /blog/{c.post.slug}\n-                        </a>\n-                      ) : null}\n-                      <div className=\"post-date\">{fmtDate(c.createdAt)}</div>\n-                    </div>\n+                    <div>{c.name || \"—\"}</div>\n+                    <div style={{ fontSize: 12, color: \"#6b7280\" }}>{c.email || \"—\"}</div>\n                   </td>\n-\n-                  <td>{c.name || \"—\"}</td>\n-                  <td>\n-                    <a href={`mailto:${c.email}`} className=\"muted link\">\n-                      {c.email}\n-                    </a>\n+                  <td title={c.message} style={{ whiteSpace: \"nowrap\", textOverflow: \"ellipsis\", overflow: \"hidden\", maxWidth: 520 }}>\n+                    {c.message}\n                   </td>\n-\n-                  <td>\n-                    <ExpandableText text={c.message} max={160} />\n-                  </td>\n-\n-                  <td>\n-                    {c.approved ? (\n-                      <span className=\"badge ok\">Approved</span>\n-                    ) : (\n-                      <span className=\"badge warn\">Pending</span>\n-                    )}\n-                  </td>\n-\n+                  <td>{c.approved ? \"Approved\" : \"Pending\"}</td>\n                   <td style={{ textAlign: \"right\" }}>\n                     {!c.approved && (\n-                      <button className=\"small\" onClick={() => approveOne(c._id)} style={{ marginRight: 8 }}>\n+                      <button onClick={() => approve(c._id)} style={{ marginRight: 8 }}>\n                         Approve\n                       </button>\n                     )}\n-                    <button className=\"small danger\" onClick={() => deleteOne(c._id)}>\n+                    <button className=\"danger\" onClick={() => remove(c._id)}>\n                       Delete\n                     </button>\n                   </td>\n                 </tr>\n               ))}\n-\n-              {!pageRows.length && (\n+              {!pageRows.length && !loading && (\n                 <tr>\n-                  <td colSpan={7} style={{ padding: 16 }}>\n-                    No comments found.\n-                  </td>\n+                  <td colSpan={5} style={{ padding: 14 }}>No comments found.</td>\n                 </tr>\n               )}\n             </tbody>\n           </table>\n         )}\n       </div>\n \n-      {/* Pagination */}\n+      {/* Pager */}\n       {totalPages > 1 && (\n-        <div className=\"pager\">\n-          <button disabled={page === 1} onClick={() => setPage((p) => Math.max(1, p - 1))}>\n-            ‹ Prev\n-          </button>\n-          <div className=\"pages\">\n+        <div style={{ display: \"flex\", gap: 8, justifyContent: \"flex-end\", marginTop: 12 }}>\n+          <button disabled={page === 1} onClick={() => setPage(p => Math.max(1, p - 1))}>‹ Prev</button>\n+          <div style={{ padding: \"6px 10px\", color: \"#6b7280\" }}>\n             Page {page} / {totalPages}\n           </div>\n-          <button disabled={page === totalPages} onClick={() => setPage((p) => Math.min(totalPages, p + 1))}>\n-            Next ›\n-          </button>\n+          <button disabled={page === totalPages} onClick={() => setPage(p => Math.min(totalPages, p + 1))}>Next ›</button>\n         </div>\n       )}\n \n-      {/* Tiny styles to match your admin look without new CSS files */}\n       <style>{`\n-        .seg { display:flex; gap:6px; }\n-        .seg-btn{ padding:6px 10px; border-radius:8px; border:1px solid #e5e7eb; background:#fff; }\n-        .seg-btn.active{ background:#111; color:#fff; border-color:#111; }\n-\n-        .table-flat{ width:100%; border-collapse:separate; border-spacing:0; }\n-        .table-flat thead th{ text-align:left; font-weight:700; padding:12px 14px; border-bottom:1px solid #eee; background:#fafafa;}\n-        .table-flat tbody td{ padding:14px; border-bottom:1px solid #f2f2f2; vertical-align:top; }\n-        .cell-post .post-title{ font-weight:600; }\n-        .cell-post .post-link{ font-size:12px; color:#6b7280; display:inline-block; margin-top:2px; }\n-        .cell-post .post-date{ font-size:12px; color:#9ca3af; margin-top:2px; }\n-\n-        .badge{ padding:4px 8px; border-radius:999px; font-size:12px; font-weight:600; display:inline-block; }\n-        .badge.ok{ background:#e9f9ee; color:#126b2e; }\n-        .badge.warn{ background:#fff7e6; color:#8a5a00; }\n-\n-        .muted{ color:#6b7280; }\n-        .small{ padding:6px 10px; border-radius:8px; }\n-        .secondary{ background:#fff; border:1px solid #e5e7eb; }\n-        .danger{ background:#111; color:#fff; }\n-        .pager{ display:flex; align-items:center; gap:12px; justify-content:flex-end; margin-top:14px; }\n-        .pages{ color:#6b7280; }\n+        .simple-table { width: 100%; border-collapse: collapse; }\n+        .simple-table th, .simple-table td { padding: 12px 14px; border-bottom: 1px solid #f0f0f0; text-align: left; }\n+        .simple-table thead th { background: #fafafa; font-weight: 700; }\n+        .danger { background: #111; color: #fff; }\n       `}</style>\n     </div>\n   );\n }\n-\n-/** Truncates long comment text with a toggle to expand/collapse */\n-function ExpandableText({ text, max = 160 }: { text: string; max?: number }) {\n-  const [open, setOpen] = useState(false);\n-  const t = text || \"\";\n-  if (t.length <= max) return <span>{t}</span>;\n-  return (\n-    <div>\n-      <span>{open ? t : t.slice(0, max) + \"…\"}</span>{\" \"}\n-      <button className=\"small secondary\" onClick={() => setOpen((v) => !v)}>\n-        {open ? \"Collapse\" : \"Read more\"}\n-      </button>\n-    </div>\n-  );\n-}\n"
                },
                {
                    "date": 1762636885134,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,25 +1,15 @@\n-// src/pages/Comments.tsx\n+// src/pages/Comments.jsx\n import { useEffect, useMemo, useState } from \"react\";\n import { adminFetch } from \"../api/adminFetch\";\n \n-type Cmt = {\n-  _id: string;\n-  post?: { slug: string; title: string };\n-  name: string;\n-  email: string;\n-  message: string;\n-  approved: boolean;\n-  createdAt?: string;\n-};\n-\n const PER_PAGE = 20;\n \n export default function Comments() {\n-  const [rows, setRows] = useState<Cmt[]>([]);\n+  const [rows, setRows] = useState([]);         // [{ _id, post:{slug,title}, name, email, message, approved, createdAt }]\n   const [loading, setLoading] = useState(true);\n   const [q, setQ] = useState(\"\");\n-  const [status, setStatus] = useState<\"all\" | \"pending\" | \"approved\">(\"all\");\n+  const [status, setStatus] = useState(\"all\");  // \"all\" | \"pending\" | \"approved\"\n   const [page, setPage] = useState(1);\n \n   async function load() {\n     setLoading(true);\n@@ -31,16 +21,16 @@\n       setLoading(false);\n     }\n   }\n \n-  useEffect(() => {\n-    load();\n-  }, []);\n+  useEffect(() => { load(); }, []);\n \n   const filtered = useMemo(() => {\n-    let list = [...rows];\n+    let list = rows.slice();\n+\n     if (status === \"pending\") list = list.filter(r => !r.approved);\n     if (status === \"approved\") list = list.filter(r => r.approved);\n+\n     if (q.trim()) {\n       const s = q.toLowerCase();\n       list = list.filter(r =>\n         (r.post?.title || \"\").toLowerCase().includes(s) ||\n@@ -49,21 +39,21 @@\n         (r.email || \"\").toLowerCase().includes(s) ||\n         (r.message || \"\").toLowerCase().includes(s)\n       );\n     }\n-    // newest first if createdAt available\n-    list.sort((a, b) => (new Date(b.createdAt || 0).getTime() - new Date(a.createdAt || 0).getTime()));\n+\n+    list.sort((a, b) => new Date(b.createdAt || 0) - new Date(a.createdAt || 0));\n     return list;\n   }, [rows, q, status]);\n \n   const totalPages = Math.max(1, Math.ceil(filtered.length / PER_PAGE));\n   const pageRows = filtered.slice((page - 1) * PER_PAGE, page * PER_PAGE);\n \n-  async function approve(id: string) {\n+  async function approve(id) {\n     await adminFetch(`/api/admin/comments/${id}/approve`, { method: \"PUT\" });\n     await load();\n   }\n-  async function remove(id: string) {\n+  async function remove(id) {\n     if (!confirm(\"Delete comment?\")) return;\n     await adminFetch(`/api/admin/comments/${id}`, { method: \"DELETE\" });\n     await load();\n   }\n@@ -75,9 +65,9 @@\n       {/* Controls */}\n       <div className=\"card\" style={{ display: \"flex\", gap: 8, alignItems: \"center\", flexWrap: \"wrap\" }}>\n         <select\n           value={status}\n-          onChange={(e) => { setStatus(e.target.value as any); setPage(1); }}\n+          onChange={(e) => { setStatus(e.target.value); setPage(1); }}\n           className=\"tf-input\"\n           style={{ width: 160 }}\n         >\n           <option value=\"all\">All</option>\n@@ -130,9 +120,12 @@\n                   <td>\n                     <div>{c.name || \"—\"}</div>\n                     <div style={{ fontSize: 12, color: \"#6b7280\" }}>{c.email || \"—\"}</div>\n                   </td>\n-                  <td title={c.message} style={{ whiteSpace: \"nowrap\", textOverflow: \"ellipsis\", overflow: \"hidden\", maxWidth: 520 }}>\n+                  <td\n+                    title={c.message}\n+                    style={{ whiteSpace: \"nowrap\", textOverflow: \"ellipsis\", overflow: \"hidden\", maxWidth: 520 }}\n+                  >\n                     {c.message}\n                   </td>\n                   <td>{c.approved ? \"Approved\" : \"Pending\"}</td>\n                   <td style={{ textAlign: \"right\" }}>\n@@ -140,18 +133,14 @@\n                       <button onClick={() => approve(c._id)} style={{ marginRight: 8 }}>\n                         Approve\n                       </button>\n                     )}\n-                    <button className=\"danger\" onClick={() => remove(c._id)}>\n-                      Delete\n-                    </button>\n+                    <button className=\"danger\" onClick={() => remove(c._id)}>Delete</button>\n                   </td>\n                 </tr>\n               ))}\n               {!pageRows.length && !loading && (\n-                <tr>\n-                  <td colSpan={5} style={{ padding: 14 }}>No comments found.</td>\n-                </tr>\n+                <tr><td colSpan={5} style={{ padding: 14 }}>No comments found.</td></tr>\n               )}\n             </tbody>\n           </table>\n         )}\n"
                },
                {
                    "date": 1762637223143,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -86,9 +86,9 @@\n         <button onClick={load} style={{ marginLeft: \"auto\" }}>Refresh</button>\n       </div>\n \n       {/* Table */}\n-      <div className=\"card\" style={{ marginTop: 12, padding: 0, overflowX: \"auto\" }}>\n+      <div className=\"card\" style={{ marginTop: 12, padding: 0, overflowX: \"auto\", ew }}>\n         {loading ? (\n           <div style={{ padding: 14 }}>Loading…</div>\n         ) : (\n           <table className=\"simple-table\">\n"
                },
                {
                    "date": 1762637229662,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -86,9 +86,9 @@\n         <button onClick={load} style={{ marginLeft: \"auto\" }}>Refresh</button>\n       </div>\n \n       {/* Table */}\n-      <div className=\"card\" style={{ marginTop: 12, padding: 0, overflowX: \"auto\", ew }}>\n+      <div className=\"card\" style={{ marginTop: 12, padding: 0, overflowX: \"auto\", width }}>\n         {loading ? (\n           <div style={{ padding: 14 }}>Loading…</div>\n         ) : (\n           <table className=\"simple-table\">\n"
                },
                {
                    "date": 1762637236323,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -86,9 +86,9 @@\n         <button onClick={load} style={{ marginLeft: \"auto\" }}>Refresh</button>\n       </div>\n \n       {/* Table */}\n-      <div className=\"card\" style={{ marginTop: 12, padding: 0, overflowX: \"auto\", width }}>\n+      <div className=\"card\" style={{ marginTop: 12, padding: 0, overflowX: \"auto\", width:\"14\" }}>\n         {loading ? (\n           <div style={{ padding: 14 }}>Loading…</div>\n         ) : (\n           <table className=\"simple-table\">\n"
                },
                {
                    "date": 1762637241581,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -86,9 +86,9 @@\n         <button onClick={load} style={{ marginLeft: \"auto\" }}>Refresh</button>\n       </div>\n \n       {/* Table */}\n-      <div className=\"card\" style={{ marginTop: 12, padding: 0, overflowX: \"auto\", width:\"14\" }}>\n+      <div className=\"card\" style={{ marginTop: 12, padding: 0, overflowX: \"auto\", width:\"13\" }}>\n         {loading ? (\n           <div style={{ padding: 14 }}>Loading…</div>\n         ) : (\n           <table className=\"simple-table\">\n"
                },
                {
                    "date": 1762637247440,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -86,9 +86,9 @@\n         <button onClick={load} style={{ marginLeft: \"auto\" }}>Refresh</button>\n       </div>\n \n       {/* Table */}\n-      <div className=\"card\" style={{ marginTop: 12, padding: 0, overflowX: \"auto\", width:\"1340p\" }}>\n+      <div className=\"card\" style={{ marginTop: 12, padding: 0, overflowX: \"auto\", width:\"1340pcx\" }}>\n         {loading ? (\n           <div style={{ padding: 14 }}>Loading…</div>\n         ) : (\n           <table className=\"simple-table\">\n"
                }
            ],
            "date": 1762458635872,
            "name": "Commit-0",
            "content": "import { useEffect, useState } from \"react\";\nimport { adminFetch } from \"../api/adminFetch\";\n\nexport default function Comments() {\n  const [rows, setRows] = useState([]);\n  const [loading, setLoading] = useState(true);\n\n  async function load() {\n    setLoading(true);\n    try {\n      const data = await adminFetch(\"/api/admin/comments\"); // all comments\n      setRows(data);\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  useEffect(() => { load(); }, []);\n\n  async function approve(id) {\n    await adminFetch(`/api/admin/comments/${id}/approve`, { method: \"PUT\" });\n    await load();\n  }\n\n  async function remove(id) {\n    if (!confirm(\"Delete comment?\")) return;\n    await adminFetch(`/api/admin/comments/${id}`, { method: \"DELETE\" });\n    await load();\n  }\n\n  return (\n    <div className=\"page\">\n      <h2>Comments Moderation</h2>\n      {loading ? <p>Loading…</p> : null}\n      <table className=\"card\" style={{ width: \"100%\" }}>\n        <thead>\n          <tr>\n            <th>Post</th>\n            <th>Name</th>\n            <th>Email</th>\n            <th>Message</th>\n            <th>Approved</th>\n            <th>Actions</th>\n          </tr>\n        </thead>\n        <tbody>\n          {rows.map((c) => (\n            <tr key={c._id}>\n              <td>{c.post?.title} <small>({c.post?.slug})</small></td>\n              <td>{c.name}</td>\n              <td>{c.email}</td>\n              <td style={{ maxWidth: 420, whiteSpace: \"pre-wrap\" }}>{c.message}</td>\n              <td>{c.approved ? \"Yes\" : \"No\"}</td>\n              <td>\n                {!c.approved && (\n                  <button onClick={() => approve(c._id)} style={{ marginRight: 8 }}>\n                    Approve\n                  </button>\n                )}\n                <button onClick={() => remove(c._id)} className=\"danger\">\n                  Delete\n                </button>\n              </td>\n            </tr>\n          ))}\n          {rows.length === 0 && !loading && (\n            <tr><td colSpan={6}>No comments yet.</td></tr>\n          )}\n        </tbody>\n      </table>\n    </div>\n  );\n}\n"
        }
    ]
}